<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>무늬기와 수막새 (핀-가로 + 스택 · 최종조정)</title>
<style>
  @font-face{
    font-family:'SUIT-Regular';
    src:url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Regular.woff2') format('woff2');
    font-weight:normal; font-style:normal;
  }

  @font-face {
    font-family: 'EbsHunminjeongeum';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/EBSHunminjeongeum.woff') format('woff');
    font-weight: normal;
    font-display: swap;
}

  /* ===== Global ===== */
  html, body{
    margin:0; padding:0; min-height:100%;
    font-family:'SUIT-Regular';
    overflow-x:hidden;
    color:#121212;
    background:#fff;
    /* 여백 예약 끔: 좌측 띠 방지 */
    scrollbar-gutter: auto;
  }
  /* 스크롤바: 보이되 그림자 없음 */
  *::-webkit-scrollbar{ width:12px; height:12px; }
  *::-webkit-scrollbar-thumb{ background:rgba(0,0,0,.25); border-radius:8px; box-shadow:none !important; }
  *::-webkit-scrollbar-track{ background:transparent; box-shadow:none !important; }
  /* Firefox */
  *{ scrollbar-width:auto; }
  img{max-width:100%; height:auto; display:block;}

  .section{ height:100vh; width:100%; display:flex; justify-content:center; align-items:center; }
  /* 내부 세로 스크롤러 방지 */
  .section, #main, .pin-horizontal, .panel, .container{ overflow-y:clip; }

  /* 간격용 스페이서 */
  .spacer-lg{ height:clamp(80px, 22vh, 240px); background:#fff; }

  /* ===== Header ===== */
  .hamburger{ position:fixed; top:30px; right:30px; z-index:1001; display:flex; flex-direction:column; gap:4px; cursor:pointer; padding:10px; transition:.3s; }
  .hamburger span{ width:25px; height:3px; background:#fff; border-radius:3px; transition:.3s; }
  .hamburger.dark span{ background:#000; }
  .home-icon{ position:fixed; top:30px; right:80px; z-index:1001; width:30px; cursor:pointer; transition:.3s; }
  .home-icon.dark svg{ stroke:#000; }

  .side-menu{ position:fixed; top:0; right:-33.33vw; width:33.33vw; min-width:300px; height:100vh; background:rgba(0,0,0,.95); backdrop-filter:blur(20px); z-index:1000; display:flex; flex-direction:column; padding:80px 0 40px; transition:right .4s cubic-bezier(.25,.46,.45,.94); }
  .side-menu.active{ right:0; }
  .side-menu .menu-header{ padding:0 40px 30px; border-bottom:1px solid rgba(255,255,255,.1); }
  .side-menu .menu-header h2{ color:#fff; font-size:28px; margin:0; }
  .side-menu .menu-items{ flex:1; padding:30px 0; }
  .side-menu a{ color:#fff; text-decoration:none; padding:20px 40px; display:block; font-size:18px; transition:.3s; border-left:3px solid transparent; }
  .side-menu a:hover{ background:rgba(255,255,255,.1); border-left-color:#fff; padding-left:50px; }
  .menu-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:999; opacity:0; visibility:hidden; transition:.3s; }
  .menu-overlay.active{ opacity:1; visibility:visible; }

  @media (max-width:768px){ .side-menu{ width:100vw; right:-100vw; min-width:unset; } .hamburger{ right:20px; } .home-icon{ right:70px; } }
  @media (max-width:480px){ .side-menu a{ font-size:16px; padding:18px 30px; } .side-menu .menu-header{ padding:0 30px 20px; } .side-menu .menu-header h2{ font-size:24px; } .home-icon{ right:60px; } }

  /* ===== Hero ===== */
  #main{
    background-image:url('img/sumak/bg.jpg');
    background-size:cover; background-position:center; position:relative; overflow:clip; height:100vh;
  }
  #main::after{
    content:""; position:absolute; inset:0; background:#000; z-index:5; pointer-events:none;
    opacity:1; animation:fadeOutScreen 1.2s ease .2s forwards;
  }
  @keyframes fadeOutScreen{ to{ opacity:0; } }
  .scroll-indicator{ position:absolute; bottom:50px; left:50%; transform:translateX(-50%); text-align:center; animation:fadeUpDown 2s infinite; z-index:10; color:#fff; font-size:20px; transition:opacity .5s; }
  .scroll-indicator .arrow{ display:block; font-size:24px; margin-top:8px; animation:bounce 1.5s infinite; }
  @keyframes bounce{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(8px)} }

  /* ===== Pin-Horizontal ===== */
  .pin-horizontal{ height:100vh; width:100%; position:relative; background:#fff; overflow:clip; margin-bottom:clamp(40px, 10vh, 120px); }
  .panel-track{ height:100%; display:flex; align-items:center; width:max-content; }
  .panel{ flex:0 0 100vw; height:100vh; position:relative; display:flex; justify-content:center; align-items:center; background:#fff; }
  .about-image-container{ width:60%; padding:60px 0; display:flex; justify-content:center; align-items:center; }
  .un-section{ display:flex; justify-content:center; align-items:center; width:100%; position:relative; }
  .un-section img{ width:100%; max-width:1200px; }
  .un-overlay-text{ position:absolute; left:10%; top:50%; transform:translateY(-50%); max-width:420px; color:#121212; }
  .about-image-container2,.about-image-container3{ width:100%; padding:60px 0; position:relative; display:flex; justify-content:center; align-items:center; }
  .about-image-container2 img{ width:70%; max-width:1000px; }
  .about-image-container3 img{ width:100%; max-width:1200px; }
  .overlay-text{ position:absolute; top:50%; transform:translateY(-50%); max-width:520px; padding:20px; color:#121212; }
  .overlay-text.left{ left:5%; text-align:left; } .overlay-text.right{ right:5%; text-align:right; }

  /* ===== Marquee + Photo Stack ===== */
  #marquee{ margin-block:clamp(40px, 12vh, 140px); }
  .marquee-stack{ position:relative; height:100vh; background:#fff; overflow:hidden; display:flex; align-items:center; justify-content:center; }
  /* 배경 마키(한 줄 중앙) */
  .marquee-bg{ position:absolute; inset:0; z-index:0; pointer-events:none; opacity:.22; }
  .marquee-wrap{ position:absolute; inset:0; display:flex; align-items:center; justify-content:flex-start; }
  .marquee-row{
    white-space:nowrap; font-size:18vw; line-height:1; font-weight:800; color:#000; letter-spacing:.02em;
    will-change:transform; animation:marquee 28s linear infinite;
  }
  @keyframes marquee{ 0%{ transform:translateX(0); } 100%{ transform:translateX(-50%); } }

  /* 사진 스택 */
  .stack{ position:relative; z-index:2; width:min(64vw, 820px); aspect-ratio:16/9; }
  .card{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%) rotate(var(--rot, 0deg));
    width:100%; height:100%; border-radius:0; overflow:hidden;
    transition:transform .4s cubic-bezier(.22,.61,.36,1);
    will-change:transform;
  }
  .card img{ width:100%; height:100%; object-fit:cover; }
  .card.bg1{ width:86%; }
  .card.bg2{ width:92%; top:48%; }
  .card.main{ z-index:5; background:none; border:none; padding:0; width:94%; }
  .card.main:hover{
    transform:translate(-50%,-50%) rotate(calc(var(--rot, 0deg) - 2deg)) scale(1.02);
  }

  /* 클릭 힌트: 간격↑ + 애니메이션 초기상태 */
  .click-hint{
    position:absolute; left:50%; bottom:-96px; transform:translateX(-50%);
    font-size:14px; letter-spacing:.2em; color:#000;
    display:flex; align-items:center; gap:.6em; pointer-events:none;
    opacity:0;  /* 최초 감춤 */
  }
  .click-hint .bracket{ display:inline-block; opacity:0; transform:translateX(0); }
  .click-hint .hint-text{ display:inline-block; opacity:0; }
  @media (max-width:600px){
    .stack{ width:88vw; }
    .click-hint{ bottom:-64px; font-size:13px; }
  }

  /* ===== Grid (last) ===== */
  #grid{ margin-top:clamp(40px, 12vh, 140px); }
  .about-image-container4{ display:flex; justify-content:center; align-items:center; width:100%; padding:100px 0; background:#fff; }
  .tile-grid{ position:relative; width:100%; height:600px; max-width:1200px; margin:0 auto; }
  .tile-item{ position:absolute; transition:transform .3s ease; z-index:1; }
  .tile-item:hover{ transform:scale(1.05); z-index:10; }
  .tile-item img{ width:100%; object-fit:contain; }

  .tile-item:nth-child(1){ width:190px; top:0%; left:32%; }
  .tile-item:nth-child(2){ width:230px; top:36%; left:19%; z-index:2; }
  .tile-item:nth-child(3){ width:450px; top:4%; left:43%; z-index:2; }
  .tile-item:nth-child(4){ width:170px; top:68%; left:35%; z-index:2; }
  .tile-item:nth-child(5){ width:190px; top:53%; left:64%; z-index:3; }
  .tile-item:nth-child(6){ width:160px; top:-12%; left:5%; z-index:3; }

  /* Appear */
  .fade-in{ opacity:0; transform:translateY(30px); transition:opacity 1s, transform 1s; }
  .fade-in.appear{ opacity:1; transform:translateY(0); }
  .stagger{ transition-delay:calc(var(--order) * 200ms); }

  @media (prefers-reduced-motion: reduce){
    #main::after{ animation:none; opacity:0; }
    .scroll-indicator, .scroll-indicator .arrow{ animation:none; }
    .marquee-row{ animation:none; }
  }

  /* 기본 커서 숨기기 */
* { cursor: none; }

/* ===== Custom Cursor (업로드 코드 베이스) ===== */
.cursor{
  position: fixed;
  width: 20px; height: 20px;
  background: rgba(128,128,128,0.8);
  border-radius: 50%;
  pointer-events: none;
  z-index: 99999;
  transform: translate(-50%, -50%);
  transition: transform .12s ease, width .25s ease, height .25s ease, background-color .25s ease, border-color .25s ease, opacity .2s ease;
  will-change: transform, width, height;
  mix-blend-mode: normal; /* 필요 시 'difference'로도 가능 */
    display:grid;
  place-items:center;  
}

/* 텍스트 기본은 감춤 */
.cursor > span{
  display:none;
  font-family: 'SUIT-Regular';
  font-size: 13px;
  letter-spacing: .2em;
  text-transform: uppercase;
  color:#000;
   line-height:1;   
  user-select: none;
}

/* ===== 히어로 전용 커서(확대 + 텍스트 표시) ===== */
.cursor--hero{
  width: 110px; height: 110px;          /* 히어로에서만 크게 */
  background: rgba(128,128,128,0.96);                     /* 안이 더 잘 보이게 */
  border: 2px solid #000;                /* 윤곽 */
}
.cursor--hero > span{
  display:block;
}

/* 터치(모바일) 환경에서는 커서 숨김 */
@media (pointer: coarse){
  .cursor{ display:none; }
}


/* ===== Pin-Horizontal 첫 패널(ABOUT 스타일) ===== */
.about-hero{
  width:100%;
  display:flex;
  justify-content:flex-start;   /* 중앙 정렬 */
  align-items:center;
  padding-left:clamp(24px, 6vw, 140px);     
}

.about-frame{
  position:relative;
  display:inline-block;
  width:clamp(320px, 56vw, 940px);   /* 사진 가로 크기 */
  z-index:2; 
}

.about-photo{ position:relative; }
.about-photo img{
  display:block;
  width:100%; height:auto; object-fit:cover;
}

/* 사진 우하단 안쪽의 'AB' (흰색) */
.about-ab{
  position:absolute;
  right:6%;                 /* 사진 오른쪽 가장자리에서 살짝 안쪽 */
  bottom:4%;                /* 사진 아래쪽에서 살짝 위 */
  color:#fff;
  font-weight:200;
  font-size:clamp(42px, 12vw, 140px);
  font-family: 'suit';
  line-height:.9;
  letter-spacing:.04em;
  pointer-events:none;
}

/* 사진 바깥 우측의 'out' (검정) — 사진 우측 가장자리와 붙어서 표시 */
.about-out{
  position:absolute;
  bottom:4%;                /* AB와 baseline 맞춤 */
  left:95%;                  /* 사진 오른쪽 바깥으로 */
  margin-left:12px;           /* 사진과 간격 */
  color:#111;
  font-weight:200;
  font-size:clamp(42px, 12vw, 140px);
  font-family: 'suit';
  line-height:.9;
  letter-spacing:.02em;
  pointer-events:none;
}

/* 'OUT' 바로 아래 '수막새' */
.about-under{
  position:absolute;
  left:90%;              /* .about-out 과 동일 기준 */
  bottom:13%;             /* .about-out 과 동일 baseline */
  margin-left:12px;      /* 이미지와 간격 */
  transform: translateY(120%);  /* out 텍스트 '아래'로 내리기 */
  white-space:nowrap;
  color:#111;
  letter-spacing:.06em;
}
.about-under > span{
  display:inline-block;
  font-family: 'EbsHunminjeongeum';
  font-size:clamp(42px, 12vw, 140px);
  font-weight:200;
}

/* 배경: 패널 오른쪽에 크게 깔고, 처음엔 왼쪽이 보이다가 스크롤하며 오른쪽이 드러남 */
#about{ overflow:hidden; }                    /* 패널 경계 밖은 잘리도록 */
.about-bg{
  position:absolute;
  right:-10vw;                               /* 살짝 패널 밖으로 넘어가게 */
  top:8vh;
  width:min(78vw, 1100px);
  height:82vh;
  opacity:.30;                               /* 배경은 살짝 흐리게 */
  pointer-events:none;
  overflow:hidden;                           /* 내부 이미지가 컨테이너에서 잘리도록 */
  z-index:0;
  filter:grayscale(10%);                     /* 필요하면 제거 */
}
.about-bg img{
  position:absolute;
  top:50%;
  right:0;
  transform:translateY(-50%) translateX(-15%);  /* 처음엔 약간 왼쪽(오른쪽이 잘려 보임) */
  height:120%;                                /* 충분히 크게 */
  max-width:none;
}

@media (max-width:600px){
  .about-under > span{
    font-size:clamp(14px, 5.5vw, 22px);
  }
}


@media (max-width:600px){
  .about-frame{ width:min(86vw, 640px); }
  .about-ab, .about-out{ font-size:clamp(34px, 16vw, 92px); }
}


</style>
</head>
<body>

  <!-- Custom Cursor -->
<div id="custom-cursor" class="cursor" aria-hidden="true"><span>scroll</span></div>

  <!-- Header -->
  <div class="hamburger" id="hamburger" aria-label="메뉴 열기"><span></span><span></span><span></span></div>
  <a href="index.html" class="home-icon" id="home-icon" aria-label="홈으로">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#f2f2f2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
      <polyline points="9 22 9 12 15 12 15 22"></polyline>
    </svg>
  </a>
  <div class="menu-overlay" id="menu-overlay"></div>
  <nav class="side-menu" id="side-menu" aria-label="사이드 메뉴">
    <div class="menu-header"><h2>메뉴</h2></div>
    <div class="menu-items">
      <a href="#main">홈</a>
      <a href="#about">수막새 소개</a>
      <a href="test1.html">갤러리</a>
      <a href="#marquee">스택 섹션</a>
      <a href="#grid">그리드</a>
    </div>
  </nav>

  <div class="container">
    <!-- 1) Hero -->
    <section id="main" class="section">
      <div class="scroll-indicator" id="scroll-indicator">
        <p>스크롤을 내려보세요</p><span class="arrow">&#8595;</span>
      </div>
    </section>

    <!-- 2) Pin-Horizontal -->
    <section class="pin-horizontal" id="pin-horizontal">
      <div class="panel-track" id="panel-track">
        <section class="panel" id="about">
  <div class="about-hero">
    <div class="about-frame">
      <figure class="about-photo">
        <!-- 원하는 수막새 이미지로 경로만 바꾸면 됨 -->
        <img src="img/sumak/h1.png" alt="수막새 사진">
      </figure>
      <div class="about-ab">AB</div>
      <div class="about-out">OUT</div>
      <div class="about-under"><span>수막새</span></div>
    </div>
  </div>
</section>
        <section class="panel" id="un">
          <div class="un-section">
            <img src="img/sumak/h2.png" alt="un 이미지" class="fade-in">
            <div class="un-overlay-text fade-in">
              <p>
                막새는 실용적으로 지붕을 보호하면서도,<br>
                문양을 통해 종교적·상징적·예술적 가치를 더했습니다.<br>
                문화유산으로서의 가치를 지닙니다.
              </p>
            </div>
          </div>
        </section>
        <section class="panel" id="panel-2">
          <div class="about-image-container2 fade-in">
            <img src="img/sumak/h3.jpg" alt="수막새 사진">
            <div class="overlay-text right fade-in">
              <p>같은 연꽃이라도 지역·시대마다 다르게 표현되어<br>막새기와는 고고학·미술사에서도 중요한 유물입니다.</p>
            </div>
          </div>
        </section>
        <section class="panel" id="panel-3">
          <div class="about-image-container3 fade-in">
            <img src="img/sumak/h4.jpg" alt="수막새 사진">
            <div class="overlay-text left fade-in">
              <p>막새 문양은 아름다움과 더불어 상징을 담고 있어<br>해석하는 즐거움이 있습니다.</p>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- spacer between sections -->
    <div class="spacer-lg" aria-hidden="true"></div>

    <!-- 3) Marquee + Photo Stack -->
    <section class="marquee-stack" id="marquee">
      <!-- BG single-line marquee -->
      <div class="marquee-bg" aria-hidden="true">
        <div class="marquee-wrap">
          <div class="marquee-row">
            SUMAKSAE &nbsp; SUMAKSAE &nbsp; SUMAKSAE &nbsp; SUMAKSAE &nbsp; SUMAKSAE &nbsp; SUMAKSAE &nbsp; SUMAKSAE &nbsp; SUMAKSAE &nbsp;
          </div>
        </div>
      </div>

      <!-- Photo stack -->
      <div class="stack">
        <div class="card bg1" data-rot="-8"><img src="img/sumak/Group 27.png" alt=""></div>
        <div class="card bg2" data-rot="6"><img src="img/sumak/Group 28.png" alt=""></div>

        <button class="card main" id="photoMain" data-rot="-5" aria-label="사진 변경">
          <img id="photoMainImg" src="img/sumak/Group 29.png" alt="메인 사진">
        </button>

        <!-- Hint with brackets -->
        <div class="click-hint" id="clickHint" aria-hidden="true">
          <span class="bracket left">[</span>
          <span class="hint-text">CLICK&nbsp;FOR&nbsp;PHOTOS</span>
          <span class="bracket right">]</span>
        </div>
      </div>
    </section>

    <!-- spacer after stack -->
    <div class="spacer-lg" aria-hidden="true"></div>

    <!-- 4) Last: Grid -->
    <section class="about-image-container4 fade-in" id="grid">
      <div class="tile-grid">
        <a href="test1.html?section=1" class="tile-item"><img src="img/sumak/Group 44.png" alt="귀면와 수막새"></a>
        <a href="test1.html?section=1" class="tile-item"><img src="img/sumak/Group 45.png" alt="원형 수막새"></a>
        <a href="test1.html?section=4" class="tile-item"><img src="img/sumak/Group 46.png" alt="꽃문양 수막새"></a>
        <a href="test1.html?section=2" class="tile-item"><img src="img/sumak/Group 47.png" alt="문자 수막새"></a>
        <a href="test1.html?section=3" class="tile-item"><img src="img/sumak/Group 48.png" alt="원형 문양 수막새"></a>
        <a href="test1.html?section=1" class="tile-item"><img src="img/sumak/more.png" alt="더 보기"></a>
      </div>
    </section>
  </div>

  <!-- GSAP -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
  <script>
    /* Header/UI */
    const hamburger = document.getElementById('hamburger');
    const homeIcon  = document.getElementById('home-icon');
    const sideMenu  = document.getElementById('side-menu');
    const menuOverlay = document.getElementById('menu-overlay');
    const mainSection = document.getElementById('main');
    const scrollIndicator = document.getElementById('scroll-indicator');

    function toggleMenu(){
      hamburger.classList.toggle('active');
      sideMenu.classList.toggle('active');
      menuOverlay.classList.toggle('active');
      document.body.style.overflow = sideMenu.classList.contains('active') ? 'hidden' : '';
    }
    hamburger.addEventListener('click', toggleMenu);
    menuOverlay.addEventListener('click', toggleMenu);
    document.addEventListener('keydown', e=>{
      if(e.key==='Escape' && sideMenu.classList.contains('active')) toggleMenu();
    });
    sideMenu.querySelectorAll('a').forEach(a=>a.addEventListener('click', ()=>{
      if(sideMenu.classList.contains('active')) toggleMenu();
    }));

    function updateHeaderUI(){
      const threshold = mainSection.offsetHeight - 100;
      const y = window.scrollY || window.pageYOffset;
      if(y > threshold){ hamburger.classList.add('dark'); homeIcon.classList.add('dark'); }
      else { hamburger.classList.remove('dark'); homeIcon.classList.remove('dark'); }
      if(scrollIndicator){
        scrollIndicator.style.opacity = y > 40 ? 0 : 1;
        scrollIndicator.style.pointerEvents = y > 40 ? 'none' : 'auto';
      }
    }
    window.addEventListener('scroll', updateHeaderUI);

    /* ===== Pin-Horizontal (px 기반, 더 긴 스크럽 거리) ===== */
    gsap.registerPlugin(ScrollTrigger);
    const pinContainer = document.getElementById('pin-horizontal');
    const track = document.getElementById('panel-track');
    const panels = gsap.utils.toArray('.panel');

    const getScrollAmount = () => Math.max(0, track.scrollWidth - pinContainer.clientWidth);

    // 스크롤 길이 확장 팩터 (값을 키우면 더 천천히)
    const SCROLL_EXPAND = 1.6;

    const horizTween = gsap.to(track, {
      x: () => -getScrollAmount(),          // 실제 가로 이동량은 동일
      ease: 'none',
      scrollTrigger: {
        id: 'pinH',
        trigger: pinContainer,
        pin: true,
        scrub: 1,
        start: 'top top',
        // 스크럽 길이 늘리기 → 더 오래 머무르며 콘텐츠가 충분히 보임
        end: () => '+=' + Math.round(
          Math.max(getScrollAmount() * SCROLL_EXPAND, getScrollAmount() + window.innerWidth * 0.5)
        ),
        anticipatePin: 1,
        invalidateOnRefresh: true,
        onUpdate: self=>{
          if(self.progress > 0){
            hamburger.classList.add('dark');
            homeIcon.classList.add('dark');
          }
        }
      }
    });

    // 패널 내부 페이드인 (수평 진행 기준)
    panels.forEach((panel)=>{
      const inside = panel.querySelectorAll('.fade-in');
      inside.forEach(el=>{
        gsap.fromTo(el, {autoAlpha:0, y:30}, {
          autoAlpha:1, y:0, duration:0.8,
          scrollTrigger:{
            containerAnimation: horizTween,
            trigger: panel,
            start: 'left center',
            toggleActions: 'play none none reverse'
          }
        });
      });
    });

    // 일반 구간 fade-in
    const appearOptions = { threshold:0.15, rootMargin:"0px 0px -100px 0px" };
    const appearOnScroll = new IntersectionObserver((entries, obs)=>{
      entries.forEach(entry=>{
        if(!entry.isIntersecting) return;
        entry.target.classList.add('appear');
        obs.unobserve(entry.target);
      });
    }, appearOptions);
    document.querySelectorAll('.fade-in').forEach((el, i)=>{
      el.style.setProperty('--order', i);
      el.classList.add('stagger');
      if(!el.closest('.pin-horizontal')) appearOnScroll.observe(el);
    });

    /* ===== Stack: 섹션 진입 타임라인 (카드 회전 + [ ] 벌어짐 + 텍스트 페이드) ===== */
    const stackCards = gsap.utils.toArray('#marquee .card');
    const clickHint = document.getElementById('clickHint');

    // 초기값 보장
    gsap.set(stackCards, {'--rot':'0deg'});
    gsap.set(clickHint, {opacity:0});
    gsap.set('#clickHint .bracket.left',  {x:0, autoAlpha:0});
    gsap.set('#clickHint .bracket.right', {x:0, autoAlpha:0});
    gsap.set('#clickHint .hint-text',     {autoAlpha:0});

    // 타임라인으로 제어(확실한 실행)
    const tlStack = gsap.timeline({
      scrollTrigger: {
        trigger: '#marquee',
        start: 'top 74%',   // 섹션이 조금 들어왔을 때 시작 (원하면 %만 조절)
        once: true,
        invalidateOnRefresh: true
      }
    });

    tlStack
      .addLabel('start')
      // 카드 회전(펼치기)
      .to(stackCards, {
        duration: 0.9,
        ease: 'power2.out',
        stagger: 0.12,
        '--rot': (i, el) => (parseFloat(el.dataset.rot || '0')) + 'deg'
      }, 'start')
      // 힌트: [ ] 좌우로 열리고 텍스트 페이드인
      .to(clickHint, {opacity:1, duration:0.01}, 'start+=0.15')
      .fromTo('#clickHint .bracket.left',  {x:0,  autoAlpha:0}, {x:-26, autoAlpha:1, duration:0.55, ease:'power2.out'}, 'start+=0.15')
      .fromTo('#clickHint .bracket.right', {x:0,  autoAlpha:0}, {x: 26, autoAlpha:1, duration:0.55, ease:'power2.out'}, 'start+=0.15')
      .fromTo('#clickHint .hint-text',     {autoAlpha:0},       {autoAlpha:1, duration:0.65, ease:'power2.out'},        'start+=0.22');

    /* 메인 이미지 클릭: 이미지 교체 + 각도 랜덤 변화 */
    const photos = ['img/sumak/Group 29.png','img/sumak/Group 28.png','img/sumak/Group 27.png'];
    let idx = 0;
    const btnMain = document.getElementById('photoMain');
    const imgMain = document.getElementById('photoMainImg');
    let currentAngle = parseFloat(btnMain.dataset.rot || '-5');

    function nextAngle(){
      let a;
      do{
        a = Math.round((Math.random()*20 - 10) * 10)/10; // -10.0 ~ 10.0
      }while(Math.abs(a - currentAngle) < 2);
      currentAngle = a;
      return a;
    }
    btnMain.addEventListener('click', ()=>{
      // 이미지 교체
      idx = (idx + 1) % photos.length;
      imgMain.style.transition = 'opacity .25s ease, transform .25s ease';
      imgMain.style.opacity = 0; imgMain.style.transform = 'scale(.98)';
      setTimeout(()=>{
        imgMain.src = photos[idx];
        imgMain.onload = ()=>{ imgMain.style.opacity = 1; imgMain.style.transform = 'scale(1)'; };
      }, 200);
      // 각도 랜덤 변경
      const ang = nextAngle();
      btnMain.style.setProperty('--rot', ang + 'deg');
    });

    // 초기 상태 정리
    window.addEventListener('load', ()=>{ ScrollTrigger.refresh(); updateHeaderUI(); });
    window.addEventListener('resize', ()=>{ ScrollTrigger.refresh(); });

    /* 앵커 → 패널 점프 */
    function scrollToPanelById(id){
      const targetPanel = document.getElementById(id);
      if(!targetPanel) return;
      const pinTop = pinContainer.getBoundingClientRect().top + window.pageYOffset;
      const index = panels.indexOf(targetPanel);
      if(index < 0) return;
      const total = getScrollAmount();
      const ratio = panels.length > 1 ? (index / (panels.length - 1)) : 0;
      const y = pinTop + total * ratio;
      window.scrollTo({ top:y, behavior:'smooth' });
    }
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click', e=>{
        const id = a.getAttribute('href').slice(1);
        const asPanel = panels.some(p=>p.id === id);
        if(asPanel){ e.preventDefault(); scrollToPanelById(id); }
        else{
          const t = document.getElementById(id);
          if(t){ e.preventDefault(); window.scrollTo({ top:t.getBoundingClientRect().top + window.pageYOffset, behavior:'smooth' }); }
        }
      });
    });

      // ===== Custom Cursor setup =====
  const $cursor = document.getElementById('custom-cursor');
  let cx = window.innerWidth/2, cy = window.innerHeight/2;

  // 마우스 위치 반영
  window.addEventListener('mousemove', (e)=>{
    cx = e.clientX; cy = e.clientY;
    $cursor.style.transform = `translate(${cx}px, ${cy}px)`;
    // 힌트: opacity 0이었다면 나타나게
    if($cursor.style.opacity !== '1') $cursor.style.opacity = '1';
  });

  // 화면을 벗어나는 경우 커서 살짝 숨김(선택)
  window.addEventListener('mouseleave', ()=>{ $cursor.style.opacity = '0'; });
  window.addEventListener('mouseenter', ()=>{ $cursor.style.opacity = '1'; });

  // 섹션 참조(있으면 사용)
  const hero = document.getElementById('main');                 // 히어로 섹션
  const pinH = document.getElementById('pin-horizontal');       // GSAP 핀-가로
  const horizontalAlt = document.getElementById('horizontal');  // (업로드 파일의) 수평 섹션

  function inView(el){
    if(!el) return false;
    const r = el.getBoundingClientRect();
    return r.top < window.innerHeight && r.bottom > 0;
  }

  function updateCursorMode(){
    const heroIn = inView(hero);
    const hScrollIn = inView(pinH) || inView(horizontalAlt);

    // 우선순위: 히어로에 있으면 "히어로 모드", 아니면 기본.
    if(heroIn){
      $cursor.classList.add('cursor--hero');
    }else{
      $cursor.classList.remove('cursor--hero');
    }

    // 수평 섹션 들어오면(히어로 이탈 이후) 기본 원형 유지 → 특별 조치 필요 없음.
    // 필요 시 색 반전 등 다른 모드를 추가하려면 여기서 조건 분기하면 됨.
  }

  // 스크롤/리사이즈 때 모드 갱신
  ['scroll','resize','load'].forEach(evt => window.addEventListener(evt, updateCursorMode));
  updateCursorMode();

  // 초기 위치 보정(페이지 진입 직후)
  requestAnimationFrame(()=>{ $cursor.style.transform = `translate(${cx}px, ${cy}px)`; });

  // ===== 힌트: 기존 코드에 wheel 스크롤로 수평 → 수직 전환 로직이 있다면
  // 전환 시점에 updateCursorMode()를 한 번 더 호출해 주면 모드가 즉시 갱신됨.

  </script>
</body>
</html>
